<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1.0"/>
  <title>Observation Boxes (Middle Height, 50% Overlay Above/Below Slider)</title>

  <!-- Roboto font for readability -->
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link 
    href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500&display=swap" 
    rel="stylesheet"
  />

  <style>
    /* Base reset & body */
    * {
      box-sizing: border-box;
    }
    body {
      font-family: "Roboto", sans-serif;
      margin: 0;
      padding: 0;
      background: #f9f9f9;
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    .page-container {
      width: 95%;
      max-width: 1400px;
      margin: 0 auto;
      padding: 10px;
    }

    /******************************************************
     *               Header / Top Controls               *
     ******************************************************/
    .header {
      display: flex;
      flex-wrap: wrap;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 10px;
      background-color: #fff;
      padding: 10px 15px;
      border-radius: 6px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.08);
    }
    .header label {
      font-size: 13px;
      margin-right: 6px;
      font-weight: 500;
    }
    .header input[type="text"] {
      font-size: 13px;
      padding: 6px;
      width: 240px;
      border: 1px solid #ccc;
      border-radius: 4px;
    }
    .buttons-container {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      align-items: center;
    }
    select#savedDataList {
      padding: 6px 8px;
      font-size: 13px;
      border: 1px solid #ccc;
      border-radius: 4px;
      min-width: 120px;
      background-color: #fff;
    }
    button {
      font-size: 13px;
      padding: 6px 12px;
      border-radius: 4px;
      border: none;
      cursor: pointer;
      background-color: #007bff;
      color: #fff;
      transition: background-color 0.2s ease;
    }
    button:hover {
      background-color: #0056b3;
    }

    /******************************************************
     *                Boxes / Sliders Grid               *
     ******************************************************/
    #boxes-container {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 12px;
      width: 100%;
    }
    .box {
      background: #fff;
      border-radius: 6px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.08);

      /* "Middle ground" vertical space - not too big, not too small */
      min-height: 500px; 
      padding: 20px;
    }

    /******************************************************
     *       Box Header (Observation label, Date/Time)   *
     ******************************************************/
    .box-header {
      margin-bottom: 16px;
    }
    .box-header-title {
      font-size: 16px; 
      font-weight: 500;
      margin-bottom: 8px;
      color: #444;
    }
    .box-header label {
      font-weight: 500;
      font-size: 14px; 
    }
    .datetime-picker {
      width: 100%;
      max-width: 200px;
      padding: 6px;
      border: 1px solid #ccc;
      border-radius: 4px;
      font-size: 14px;
      margin-top: 6px;
    }

    /******************************************************
     *       Slider Containers (height: 50px)            *
     ******************************************************/
    .slider-container {
      position: relative;
      width: 100%;
      height: 50px;
      margin-bottom: 16px;
    }

    .slider-title {
      position: absolute;
      top: 4px;
      left: 0;
      right: 0;
      font-size: 14px;
      font-weight: 500;
      color: #444;
      margin: 0;
      padding: 0 4px;
    }
    .slider-title span {
      color: #007bff;
      font-weight: 500;
    }

    /* 
     * The green overlay should be half above & half below the slider line
     * If the slider line is at 50%, then top=25% & bottom=25% => 50% total
     */
    .ideal-range {
      position: absolute;
      left: 0; 
      right: 0;
      top: 25%;
      bottom: 25%;
      background-color: rgba(76, 175, 80, 0.27); /* alpha=0.27, no border */
      z-index: 5; /* on top of track */
      pointer-events: none;
    }

    /* The slider track at 50% => exactly center line. z-index=2 */
    input[type="range"] {
      position: absolute;
      top: 50%; 
      left: 0;
      right: 0;
      transform: translateY(-50%);
      height: 4px;
      background: #ddd;
      outline: none;
      opacity: 0.9;
      -webkit-appearance: none;
      transition: opacity 0.2s;
      z-index: 2;
    }
    input[type="range"]:hover {
      opacity: 1;
    }

    /* Triangular thumb on top of the green overlay */
    input[type="range"]::-webkit-slider-thumb {
      -webkit-appearance: none;
      appearance: none;
      width: 18px;
      height: 18px;
      background: var(--slider-thumb-color, #4CAF50);
      clip-path: polygon(50% 0%, 0% 100%, 100% 100%);
      cursor: pointer;
      border: none;
      box-shadow: none;
      position: relative;
      z-index: 6;
    }
    input[type="range"]::-moz-range-thumb {
      width: 18px;
      height: 18px;
      background: var(--slider-thumb-color, #4CAF50);
      clip-path: polygon(50% 0%, 0% 100%, 100% 100%);
      cursor: pointer;
      border: none;
      box-shadow: none;
      position: relative;
      z-index: 6;
    }

    /* Bottom labels pinned near the container's bottom (4px), on top (z-index=7) */
    .slider-labels {
      position: absolute;
      bottom: 4px; 
      left: 0; 
      right: 0;
      display: flex;
      justify-content: space-between;
      font-size: 12px; 
      color: #666;
      margin: 0;
      padding: 0 4px;
      z-index: 7;
    }
  </style>
</head>
<body>
  <div class="page-container">
    <!-- Header: Title, Save, Retrieve, etc. -->
    <div class="header">
      <label for="title">Title:</label>
      <input type="text" id="title" placeholder="Enter Title">
      <div class="buttons-container">
        <button id="saveButton">Save</button>
        <select id="savedDataList"></select>
        <button id="retrieveDataButton">Retrieve Data</button>
        <button id="clearButton">Clear Fields</button>
        <button id="deleteDataButton">Delete Data</button>
      </div>
    </div>

    <!-- Template for one "Observation" box -->
    <template id="box-template">
      <div class="box">
        <div class="box-header">
          <div class="box-header-title">
            Observation<span class="sequence-number">1</span>
          </div>
          <div>
            <label>Date/Time:</label>
            <input type="datetime-local" class="datetime-picker">
          </div>
        </div>

        <!-- All 9 sliders with the updated 50px container & 50% line -->
        <!-- Temperature -->
        <div class="slider-container">
          <div class="slider-title">
            Temperature: <span class="temperature-value">65</span>°F
          </div>
          <div 
            class="ideal-range"
            style="
              left: calc((78 - 65) / (90 - 65) * 100%);
              width: calc((82 - 78) / (90 - 65) * 100%);
            ">
          </div>
          <input 
            type="range"
            min="65"
            max="90"
            value="65"
            class="temperature-slider"
            step="1"
            data-ideal-min="78"
            data-ideal-max="82">
          <div class="slider-labels">
            <span>65°F</span>
            <span>70°F</span>
            <span>75°F</span>
            <span>80°F</span>
            <span>85°F</span>
            <span>90°F</span>
          </div>
        </div>

        <!-- Time -->
        <div class="slider-container">
          <div class="slider-title">
            Time: <span class="time-value">0</span> hrs
          </div>
          <div 
            class="ideal-range"
            style="
              left: calc((3.5 - 0) / (8 - 0) * 100%);
              width: calc((4.5 - 3.5) / (8 - 0) * 100%);
            ">
          </div>
          <input
            type="range"
            min="0"
            max="8"
            value="0"
            class="time-slider"
            step="0.25"
            data-ideal-min="3.5"
            data-ideal-max="4.5">
          <div class="slider-labels">
            <span>0 hrs</span>
            <span>1 hr</span>
            <span>2 hrs</span>
            <span>3 hrs</span>
            <span>4 hrs</span>
            <span>5 hrs</span>
            <span>6 hrs</span>
            <span>7 hrs</span>
            <span>8 hrs</span>
          </div>
        </div>

        <!-- Percent Rise -->
        <div class="slider-container">
          <div class="slider-title">
            Percent Rise: <span class="percent-rise-value">0</span>%
          </div>
          <div 
            class="ideal-range"
            style="
              left: calc((20 - 0) / (100 - 0) * 100%);
              width: calc((30 - 20) / (100 - 0) * 100%);
            ">
          </div>
          <input
            type="range"
            min="0"
            max="100"
            value="0"
            class="percent-rise-slider"
            step="1"
            data-ideal-min="20"
            data-ideal-max="30">
          <div class="slider-labels">
            <span>0%</span>
            <span>20%</span>
            <span>40%</span>
            <span>60%</span>
            <span>80%</span>
            <span>100%</span>
          </div>
        </div>

        <!-- Domed on Top -->
        <div class="slider-container">
          <div class="slider-title">
            Domed on Top: <span class="domed-on-top-value">Flat</span>
          </div>
          <div 
            class="ideal-range"
            style="
              left: calc((1 - 0) / (4 - 0) * 100%);
              width: calc((3 - 1) / (4 - 0) * 100%);
            ">
          </div>
          <input
            type="range"
            min="0"
            max="4"
            value="0"
            class="domed-on-top-slider"
            step="0.01"
            data-ideal-min="1"
            data-ideal-max="3">
          <div class="slider-labels">
            <span>Flat</span>
            <span>Low</span>
            <span>High</span>
            <span>Deflated</span>
          </div>
        </div>

        <!-- Bubbles on Top -->
        <div class="slider-container">
          <div class="slider-title">
            Bubbles on Top: <span class="bubbles-on-top-value">None</span>
          </div>
          <div 
            class="ideal-range"
            style="
              left: calc((1 - 0) / (3 - 0) * 100%);
              width: calc((2 - 1) / (3 - 0) * 100%);
            ">
          </div>
          <input
            type="range"
            min="0"
            max="3"
            value="0"
            class="bubbles-on-top-slider"
            step="0.01"
            data-ideal-min="1"
            data-ideal-max="2">
          <div class="slider-labels">
            <span>None</span>
            <span>Few</span>
            <span>Many</span>
            <span>Deflated</span>
          </div>
        </div>

        <!-- Bubbles on Sides -->
        <div class="slider-container">
          <div class="slider-title">
            Bubbles on Sides: <span class="bubbles-on-sides-value">None</span>
          </div>
          <div 
            class="ideal-range"
            style="
              left: calc((1 - 0) / (3 - 0) * 100%);
              width: calc((2 - 1) / (3 - 0) * 100%);
            ">
          </div>
          <input
            type="range"
            min="0"
            max="3"
            value="0"
            class="bubbles-on-sides-slider"
            step="0.01"
            data-ideal-min="1"
            data-ideal-max="2">
          <div class="slider-labels">
            <span>None</span>
            <span>Few</span>
            <span>Many</span>
            <span>Deflated</span>
          </div>
        </div>

        <!-- Wobble Test -->
        <div class="slider-container">
          <div class="slider-title">
            Wobble Test: <span class="wobble-test-value">Stiff</span>
          </div>
          <div 
            class="ideal-range"
            style="
              left: calc((0.5 - 0) / (2 - 0) * 100%);
              width: calc((1.5 - 0.5) / (2 - 0) * 100%);
            ">
          </div>
          <input
            type="range"
            min="0"
            max="2"
            value="0"
            class="wobble-test-slider"
            step="0.01"
            data-ideal-min="0.5"
            data-ideal-max="1.5">
          <div class="slider-labels">
            <span>Stiff</span>
            <span>Loose and Aerated</span>
            <span>Liquified</span>
          </div>
        </div>

        <!-- Windowpane -->
        <div class="slider-container">
          <div class="slider-title">
            Windowpane: <span class="windowpane-value">Thick and Stiff</span>
          </div>
          <div 
            class="ideal-range"
            style="
              left: calc((0.5 - 0) / (2 - 0) * 100%);
              width: calc((1.5 - 0.5) / (2 - 0) * 100%);
            ">
          </div>
          <input
            type="range"
            min="0"
            max="2"
            value="0"
            class="windowpane-slider"
            step="0.01"
            data-ideal-min="0.5"
            data-ideal-max="1.5">
          <div class="slider-labels">
            <span>Thick and Stiff</span>
            <span>Strong and Translucent</span>
            <span>Weak</span>
          </div>
        </div>

        <!-- Smell -->
        <div class="slider-container">
          <div class="slider-title">
            Smell: <span class="smell-value">Floury</span>
          </div>
          <div 
            class="ideal-range"
            style="
              left: calc((1 - 0) / (4 - 0) * 100%);
              width: calc((3 - 1) / (4 - 0) * 100%);
            ">
          </div>
          <input
            type="range"
            min="0"
            max="4"
            value="0"
            class="smell-slider"
            step="0.01"
            data-ideal-min="1"
            data-ideal-max="3">
          <div class="slider-labels">
            <span>Floury</span>
            <span>Ripe</span>
            <span>Sweet</span>
            <span>Acidic</span>
            <span>Starter-like</span>
          </div>
        </div>
      </div> <!-- end .box -->
    </template>

    <div id="boxes-container"></div>
  </div><!-- end .page-container -->

  <script>
    /**************************************************
     *   Arrays for special text-based slider values  *
     **************************************************/
    const domedOnTopValues = ["Flat", "Low", "High", "Deflated"];
    const bubblesOnTopValues = ["None", "Few", "Many", "Deflated"];
    const bubblesOnSidesValues = ["None", "Few", "Many", "Deflated"];
    const wobbleTestValues = ["Stiff", "Loose and Aerated", "Liquified"];
    const windowpaneValues = ["Thick and Stiff", "Strong and Translucent", "Weak"];
    const smellValues = ["Floury", "Ripe", "Sweet", "Acidic", "Starter-like"];

    function getSliderKey(slider) {
      // e.g. "temperature-slider-1"
      return Array.from(slider.classList).find(cls => cls.match(/-slider-\d+$/)) || "unknown-slider";
    }

    function updateSliderValue(slider, valueElement) {
      const sliderKey = getSliderKey(slider);
      const idealMin = parseFloat(slider.getAttribute('data-ideal-min'));
      const idealMax = parseFloat(slider.getAttribute('data-ideal-max'));
      valueElement.innerText = slider.value;

      // color the thumb if outside range
      if (slider.value < idealMin || slider.value > idealMax) {
        slider.style.setProperty('--slider-thumb-color', 'red');
      } else {
        slider.style.setProperty('--slider-thumb-color', '#4CAF50');
      }

      // For certain sliders, display descriptive text
      if (valueElement.classList.contains("domed-on-top-value")) {
        valueElement.innerText = domedOnTopValues[Math.round(slider.value)];
      } else if (valueElement.classList.contains("bubbles-on-top-value")) {
        valueElement.innerText = bubblesOnTopValues[Math.round(slider.value)];
      } else if (valueElement.classList.contains("bubbles-on-sides-value")) {
        valueElement.innerText = bubblesOnSidesValues[Math.round(slider.value)];
      } else if (valueElement.classList.contains("wobble-test-value")) {
        valueElement.innerText = wobbleTestValues[Math.round(slider.value)];
      } else if (valueElement.classList.contains("windowpane-value")) {
        valueElement.innerText = windowpaneValues[Math.round(slider.value)];
      } else if (valueElement.classList.contains("smell-value")) {
        valueElement.innerText = smellValues[Math.round(slider.value)];
      }
    }

    function initializeSlider(slider) {
      const sliderKey = getSliderKey(slider);
      const valueClass = sliderKey.replace("slider","value");
      const valueElement = slider.parentElement.querySelector(`.${valueClass}`);
      if (!valueElement) return;

      // set initial
      updateSliderValue(slider, valueElement);

      slider.addEventListener('input', () => {
        updateSliderValue(slider, valueElement);
      });
    }

    document.addEventListener('DOMContentLoaded', () => {
      const template = document.getElementById('box-template');
      const container = document.getElementById('boxes-container');

      // Create 8 boxes
      for (let i = 0; i < 8; i++) {
        const clone = document.importNode(template.content, true);
        // "Observation X"
        clone.querySelector('.sequence-number').innerText = i + 1;
        container.appendChild(clone);

        // rename each slider class
        const thisBox = container.querySelectorAll('.box')[i];
        const rangeInputs = thisBox.querySelectorAll('input[type="range"]');
        rangeInputs.forEach(rng => {
          const baseClass = Array.from(rng.classList).find(c => c.endsWith('-slider'));
          if (baseClass) {
            rng.classList.remove(baseClass);
            rng.classList.add(`${baseClass}-${i+1}`);

            const oldValueClass = baseClass.replace("slider","value");
            const valEl = rng.parentElement.querySelector(`.${oldValueClass}`);
            if (valEl) {
              valEl.classList.remove(oldValueClass);
              valEl.classList.add(`${oldValueClass}-${i+1}`);
            }
          }
        });
      }

      // initialize all sliders
      const allSliders = document.querySelectorAll('input[type="range"]');
      allSliders.forEach(initializeSlider);

      // load any localStorage keys
      loadSavedDataNames();
    });

    function saveSliderData() {
      const title = document.getElementById('title').value.trim();
      if (!title) {
        alert("Please enter a title before saving.");
        return;
      }
      const sliders = document.querySelectorAll('input[type="range"]');
      const datePickers = document.querySelectorAll('.datetime-picker');
      const data = { sliders: {}, datePickers: [] };

      sliders.forEach(slider => {
        const sliderKey = getSliderKey(slider);
        data.sliders[sliderKey] = slider.value;
      });
      datePickers.forEach(picker => {
        data.datePickers.push(picker.value);
      });

      localStorage.setItem(title, JSON.stringify({ title, data }));
      alert("Data saved!");
      loadSavedDataNames();
    }

    function loadSavedDataNames() {
      const savedDataList = document.getElementById('savedDataList');
      savedDataList.innerHTML = "";
      const defaultOption = document.createElement('option');
      defaultOption.value = "";
      defaultOption.textContent = "Select One";
      savedDataList.appendChild(defaultOption);

      for (let i = 0; i < localStorage.length; i++) {
        const key = localStorage.key(i);
        if (key !== null) {
          const option = document.createElement('option');
          option.value = key;
          option.textContent = key;
          savedDataList.appendChild(option);
        }
      }
    }

    function loadSliderData() {
      const selectedKey = document.getElementById('savedDataList').value;
      if (!selectedKey) {
        alert("Please select a data set to load.");
        return;
      }
      const savedDataJSON = localStorage.getItem(selectedKey);
      if (!savedDataJSON) {
        alert("No data found for the selected title.");
        return;
      }

      const savedData = JSON.parse(savedDataJSON);
      const { title, data } = savedData;
      document.getElementById('title').value = title;

      const sliders = document.querySelectorAll('input[type="range"]');
      sliders.forEach(slider => {
        const sliderKey = getSliderKey(slider);
        if (data.sliders.hasOwnProperty(sliderKey)) {
          slider.value = data.sliders[sliderKey];
          const valueClass = sliderKey.replace("slider","value");
          const valueElement = slider.parentElement.querySelector(`.${valueClass}`);
          updateSliderValue(slider, valueElement);
        }
      });

      const datePickers = document.querySelectorAll('.datetime-picker');
      datePickers.forEach((picker, idx) => {
        picker.value = data.datePickers[idx] || "";
      });
    }

    function deleteSliderData() {
      const selectedKey = document.getElementById('savedDataList').value;
      if (!selectedKey) {
        alert("Please select a data set to delete.");
        return;
      }
      localStorage.removeItem(selectedKey);
      alert("Data deleted!");
      loadSavedDataNames();
    }

    document.getElementById('saveButton').addEventListener('click', saveSliderData);
    document.getElementById('retrieveDataButton').addEventListener('click', loadSliderData);
    document.getElementById('deleteDataButton').addEventListener('click', deleteSliderData);
    document.getElementById('clearButton').addEventListener('click', () => {
      const sliders = document.querySelectorAll('input[type="range"]');
      sliders.forEach(slider => {
        slider.value = slider.min;
        const valueClass = getSliderKey(slider).replace("slider","value");
        const valueElement = slider.parentElement.querySelector(`.${valueClass}`);
        updateSliderValue(slider, valueElement);
      });
      const datePickers = document.querySelectorAll('.datetime-picker');
      datePickers.forEach(p => (p.value = ''));
    });
  </script>
</body>
</html>
